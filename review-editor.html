<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¡¹ç›®å¤ç›˜ - AIGCæœè£…è®¾è®¡</title>
    <style>
        /* å…¨å±€æ ·å¼é‡ç½®ä¸åŸºç¡€è®¾ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background-color: #ffffff;
            color: #4b5563;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* é…è‰²æ–¹æ¡ˆå˜é‡ */
        :root {
            --primary-blue: #3b82f6;
            --success-green: #10b981;
            --warning-orange: #f59e0b;
            --error-red: #ef4444;
            --neutral-gray: #6b7280;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --text-primary: #111827;
            --text-secondary: #374151;
            --text-body: #4b5563;
            --text-muted: #9ca3af;
            --border-color: #e5e7eb;
        }

        /* é¡¶éƒ¨æ“ä½œæ  */
        .header {
            height: 60px;
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .back-btn {
            width: 36px;
            height: 36px;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .back-btn:hover {
            background: var(--bg-secondary);
            border-color: var(--primary-blue);
        }

        .header-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .project-info {
            font-size: 13px;
            color: var(--text-muted);
            margin-left: 12px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-secondary {
            background: var(--bg-primary);
            color: var(--text-body);
            border-color: var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
            border-color: var(--primary-blue);
        }

        .btn-primary {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ä¸»ç¼–è¾‘åŒºåŸŸ */
        .editor-container {
            margin-top: 60px;
            height: calc(100vh - 60px);
            display: flex;
        }

        /* ä¸‰æ ç¼–è¾‘å™¨ */
        .editor-columns {
            display: flex;
            width: 100%;
            height: 100%;
        }

        .editor-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color);
            background: var(--bg-primary);
            position: relative;
        }

        .editor-column:last-child {
            border-right: none;
        }

        /* åˆ—æ ‡é¢˜æ  */
        .column-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-secondary);
        }

        .column-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .column-icon {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 600;
        }

        .highlights-column .column-icon {
            background: var(--success-green);
        }

        .market-data-column .column-icon {
            background: var(--primary-blue);
        }

        .issues-column .column-icon {
            background: var(--warning-orange);
        }

        .word-count {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* ç¼–è¾‘å™¨å†…å®¹åŒº */
        .editor-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow: hidden;
        }

        /* å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ */
        .rich-editor {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .editor-toolbar {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 12px;
        }

        .toolbar-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
            color: var(--text-body);
        }

        .toolbar-btn:hover {
            background: var(--bg-secondary);
        }

        .toolbar-btn.active {
            background: var(--primary-blue);
            color: white;
        }

        .editor-textarea {
            flex: 1;
            border: none;
            outline: none;
            resize: none;
            font-size: 14px;
            line-height: 1.6;
            color: var(--text-body);
            background: transparent;
            padding: 12px 0;
        }

        .editor-textarea::placeholder {
            color: var(--text-muted);
        }

        /* æ¨¡æ¿æç¤ºåŒºåŸŸ */
        .template-hints {
            margin-top: 16px;
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            border-left: 3px solid var(--primary-blue);
        }

        .template-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .template-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .template-item {
            font-size: 12px;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px 6px;
            border-radius: 3px;
            transition: all 0.2s;
        }

        .template-item:hover {
            background: var(--bg-primary);
            color: var(--primary-blue);
        }

        /* æ•°æ®è¾“å…¥ç»„ä»¶ */
        .data-inputs {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .input-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .input-field {
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            color: var(--text-body);
            transition: border-color 0.2s;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .input-field[type="number"] {
            text-align: right;
        }

        /* è¯„åˆ†ç»„ä»¶ */
        .rating-input {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .star-rating {
            display: flex;
            gap: 2px;
        }

        .star {
            width: 20px;
            height: 20px;
            cursor: pointer;
            transition: color 0.2s;
            color: var(--border-color);
        }

        .star:hover,
        .star.active {
            color: #fbbf24;
        }

        .rating-value {
            font-size: 14px;
            color: var(--text-body);
            margin-left: 8px;
        }

        /* å›¾è¡¨é¢„è§ˆ */
        .chart-preview {
            margin-top: 16px;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }

        .chart-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .chart-bar {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .bar-label {
            font-size: 11px;
            color: var(--text-muted);
            width: 60px;
        }

        .bar-visual {
            flex: 1;
            height: 16px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-blue), #60a5fa);
            border-radius: 8px;
            transition: width 0.3s ease;
        }

        .bar-value {
            font-size: 11px;
            color: var(--text-body);
            font-weight: 500;
            width: 40px;
            text-align: right;
        }

        /* é—®é¢˜åˆ—è¡¨ç¼–è¾‘å™¨ */
        .issues-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .issue-item {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 16px;
            border: 1px solid var(--border-color);
            position: relative;
        }

        .issue-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .priority-select {
            padding: 4px 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 12px;
            color: var(--text-body);
        }

        .remove-issue {
            width: 24px;
            height: 24px;
            border: none;
            background: var(--error-red);
            color: white;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .issue-content {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .issue-textarea {
            border: none;
            background: var(--bg-primary);
            border-radius: 4px;
            padding: 8px;
            font-size: 13px;
            resize: none;
            min-height: 60px;
        }

        .add-issue-btn {
            padding: 12px;
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .add-issue-btn:hover {
            border-color: var(--primary-blue);
            color: var(--primary-blue);
            background: rgba(59, 130, 246, 0.05);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .editor-columns {
                flex-direction: column;
            }
            
            .editor-column {
                border-right: none;
                border-bottom: 1px solid var(--border-color);
                min-height: 400px;
            }
            
            .editor-column:last-child {
                border-bottom: none;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 0 16px;
            }
            
            .header-left {
                gap: 8px;
            }
            
            .project-info {
                display: none;
            }
            
            .editor-content {
                padding: 16px;
            }
            
            .btn {
                padding: 6px 12px;
                font-size: 13px;
            }
        }

        /* è‡ªåŠ¨ä¿å­˜æŒ‡ç¤ºå™¨ */
        .auto-save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 8px 12px;
            background: var(--success-green);
            color: white;
            border-radius: 6px;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }

        .auto-save-indicator.show {
            opacity: 1;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        .editor-content::-webkit-scrollbar {
            width: 6px;
        }

        .editor-content::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        .editor-content::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        .editor-content::-webkit-scrollbar-thumb:hover {
            background: var(--neutral-gray);
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨æ“ä½œæ  -->
    <header class="header">
        <div class="header-left">
            <button class="back-btn" onclick="goBack()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </button>
            <div>
                <span class="header-title">é¡¹ç›®å¤ç›˜</span>
                <span class="project-info">æ˜¥å­£ä¼‘é—²Tæ¤è®¾è®¡ - PROJ-2024-001</span>
            </div>
        </div>
        <div class="header-right">
            <button class="btn btn-secondary" onclick="saveDraft()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                    <polyline points="17,21 17,13 7,13 7,21"></polyline>
                    <polyline points="7,3 7,8 15,8"></polyline>
                </svg>
                ä¿å­˜è‰ç¨¿
            </button>
            <button class="btn btn-primary" id="submitBtn" onclick="submitReview()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9,11 12,14 22,4"></polyline>
                    <path d="M21,12v7a2 2 0 0 1-2,2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                </svg>
                æäº¤å¤ç›˜
            </button>
        </div>
    </header>

    <!-- ä¸»ç¼–è¾‘åŒºåŸŸ -->
    <main class="editor-container">
        <div class="editor-columns">
            <!-- è®¾è®¡äº®ç‚¹æ  -->
            <div class="editor-column highlights-column">
                <div class="column-header">
                    <div class="column-title">
                        <div class="column-icon">âœ¨</div>
                        è®¾è®¡äº®ç‚¹
                    </div>
                    <div class="word-count" id="highlightsWordCount">0/2000</div>
                </div>
                <div class="editor-content">
                    <div class="rich-editor">
                        <div class="editor-toolbar">
                            <button class="toolbar-btn" onclick="formatText('bold')" title="åŠ ç²—">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"></path>
                                    <path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"></path>
                                </svg>
                            </button>
                            <button class="toolbar-btn" onclick="formatText('italic')" title="æ–œä½“">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="19" y1="4" x2="10" y2="4"></line>
                                    <line x1="14" y1="20" x2="5" y2="20"></line>
                                    <line x1="15" y1="4" x2="9" y2="20"></line>
                                </svg>
                            </button>
                            <button class="toolbar-btn" onclick="insertList()" title="åˆ—è¡¨">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="8" y1="6" x2="21" y2="6"></line>
                                    <line x1="8" y1="12" x2="21" y2="12"></line>
                                    <line x1="8" y1="18" x2="21" y2="18"></line>
                                    <line x1="3" y1="6" x2="3.01" y2="6"></line>
                                    <line x1="3" y1="12" x2="3.01" y2="12"></line>
                                    <line x1="3" y1="18" x2="3.01" y2="18"></line>
                                </svg>
                            </button>
                            <button class="toolbar-btn" onclick="insertImage('highlights')" title="æ’å…¥å›¾ç‰‡">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                    <polyline points="21,15 16,10 5,21"></polyline>
                                </svg>
                            </button>
                        </div>
                        <textarea 
                            class="editor-textarea" 
                            id="highlightsEditor"
                            placeholder="æè¿°æœ¬æ¬¡è®¾è®¡çš„äº®ç‚¹å’Œåˆ›æ–°ä¹‹å¤„ï¼ŒåŒ…æ‹¬è®¾è®¡ç†å¿µã€è§†è§‰æ•ˆæœã€å·¥è‰ºç‰¹è‰²ç­‰..."
                            oninput="updateWordCount('highlights')"
                            maxlength="2000"
                        ></textarea>
                    </div>
                    
                    <div class="template-hints">
                        <div class="template-title">å¸¸ç”¨æ¨¡æ¿</div>
                        <div class="template-list">
                            <div class="template-item" onclick="insertTemplate('highlights', 'æœ¬æ¬¡è®¾è®¡åœ¨è‰²å½©æ­é…ä¸Š...')">â€¢ è‰²å½©æ­é…äº®ç‚¹</div>
                            <div class="template-item" onclick="insertTemplate('highlights', 'è®¾è®¡å¸ˆå·§å¦™è¿ç”¨äº†...')">â€¢ è®¾è®¡æŠ€å·§è¿ç”¨</div>
                            <div class="template-item" onclick="insertTemplate('highlights', 'é¢æ–™é€‰æ‹©ä¸Šé‡‡ç”¨äº†...')">â€¢ é¢æ–™å·¥è‰ºåˆ›æ–°</div>
                            <div class="template-item" onclick="insertTemplate('highlights', 'æ•´ä½“è®¾è®¡é£æ ¼...')">â€¢ é£æ ¼ç‰¹è‰²æ€»ç»“</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å¸‚åœºæ•°æ®è¡¨ç°æ  -->
            <div class="editor-column market-data-column">
                <div class="column-header">
                    <div class="column-title">
                        <div class="column-icon">ğŸ“Š</div>
                        å¸‚åœºæ•°æ®è¡¨ç°
                    </div>
                    <div class="word-count" id="marketDataWordCount">0/2000</div>
                </div>
                <div class="editor-content">
                    <div class="data-inputs">
                        <!-- é”€é‡æ•°æ® -->
                        <div class="input-group">
                            <label class="input-label">é”€é‡æ•°æ® (å•ä½: ä»¶)</label>
                            <input type="number" class="input-field" id="salesVolume" placeholder="è¾“å…¥é”€é‡æ•°æ®" oninput="updateChart()">
                        </div>
                        
                        <!-- è½¬åŒ–ç‡ -->
                        <div class="input-group">
                            <label class="input-label">è½¬åŒ–ç‡ (%)</label>
                            <input type="number" class="input-field" id="conversionRate" placeholder="è¾“å…¥è½¬åŒ–ç‡" step="0.1" max="100" oninput="updateChart()">
                        </div>
                        
                        <!-- ç”¨æˆ·åé¦ˆè¯„åˆ† -->
                        <div class="input-group">
                            <label class="input-label">ç”¨æˆ·åé¦ˆè¯„åˆ†</label>
                            <div class="rating-input">
                                <div class="star-rating" id="userRating">
                                    <svg class="star" onclick="setRating(1)" viewBox="0 0 24 24" fill="currentColor">
                                        <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"></polygon>
                                    </svg>
                                    <svg class="star" onclick="setRating(2)" viewBox="0 0 24 24" fill="currentColor">
                                        <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"></polygon>
                                    </svg>
                                    <svg class="star" onclick="setRating(3)" viewBox="0 0 24 24" fill="currentColor">
                                        <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"></polygon>
                                    </svg>
                                    <svg class="star" onclick="setRating(4)" viewBox="0 0 24 24" fill="currentColor">
                                        <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"></polygon>
                                    </svg>
                                    <svg class="star" onclick="setRating(5)" viewBox="0 0 24 24" fill="currentColor">
                                        <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"></polygon>
                                    </svg>
                                </div>
                                <span class="rating-value" id="ratingValue">0åˆ†</span>
                            </div>
                        </div>
                        
                        <!-- ç”¨æˆ·åé¦ˆæ–‡å­— -->
                        <div class="input-group">
                            <label class="input-label">ç”¨æˆ·åé¦ˆè¯¦æƒ…</label>
                            <textarea 
                                class="input-field" 
                                id="userFeedback" 
                                rows="4" 
                                placeholder="æ€»ç»“ç”¨æˆ·çš„åé¦ˆæ„è§å’Œå»ºè®®..."
                                oninput="updateWordCount('marketData')"
                                maxlength="1000"
                            ></textarea>
                        </div>
                    </div>
                    
                    <!-- å›¾è¡¨é¢„è§ˆ -->
                    <div class="chart-preview">
                        <div class="chart-title">æ•°æ®å¯è§†åŒ–é¢„è§ˆ</div>
                        <div class="chart-bar">
                            <div class="bar-label">é”€é‡</div>
                            <div class="bar-visual">
                                <div class="bar-fill" id="salesBar" style="width: 0%"></div>
                            </div>
                            <div class="bar-value" id="salesValue">0</div>
                        </div>
                        <div class="chart-bar">
                            <div class="bar-label">è½¬åŒ–ç‡</div>
                            <div class="bar-visual">
                                <div class="bar-fill" id="conversionBar" style="width: 0%"></div>
                            </div>
                            <div class="bar-value" id="conversionValue">0%</div>
                        </div>
                        <div class="chart-bar">
                            <div class="bar-label">ç”¨æˆ·è¯„åˆ†</div>
                            <div class="bar-visual">
                                <div class="bar-fill" id="ratingBar" style="width: 0%"></div>
                            </div>
                            <div class="bar-value" id="ratingBarValue">0åˆ†</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- é—®é¢˜&æ”¹è¿›æ  -->
            <div class="editor-column issues-column">
                <div class="column-header">
                    <div class="column-title">
                        <div class="column-icon">âš ï¸</div>
                        é—®é¢˜ & æ”¹è¿›
                    </div>
                    <div class="word-count" id="issuesWordCount">0/2000</div>
                </div>
                <div class="editor-content">
                    <div class="issues-list" id="issuesList">
                        <!-- é»˜è®¤é—®é¢˜é¡¹ -->
                        <div class="issue-item">
                            <div class="issue-header">
                                <select class="priority-select">
                                    <option value="high">é«˜ä¼˜å…ˆçº§</option>
                                    <option value="medium" selected>ä¸­ä¼˜å…ˆçº§</option>
                                    <option value="low">ä½ä¼˜å…ˆçº§</option>
                                </select>
                                <button class="remove-issue" onclick="removeIssue(this)">Ã—</button>
                            </div>
                            <div class="issue-content">
                                <textarea 
                                    class="issue-textarea" 
                                    placeholder="é—®é¢˜æè¿°..."
                                    oninput="updateWordCount('issues')"
                                ></textarea>
                                <textarea 
                                    class="issue-textarea" 
                                    placeholder="æ”¹è¿›å»ºè®®..."
                                    oninput="updateWordCount('issues')"
                                ></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <button class="add-issue-btn" onclick="addIssue()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        æ·»åŠ æ–°é—®é¢˜
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- è‡ªåŠ¨ä¿å­˜æŒ‡ç¤ºå™¨ -->
    <div class="auto-save-indicator" id="autoSaveIndicator">
        å·²è‡ªåŠ¨ä¿å­˜
    </div>

    <script>
        // å…¨å±€æ•°æ®
        let reviewData = {
            projectId: 'PROJ-2024-001',
            highlights: '',
            marketData: {
                salesVolume: 0,
                conversionRate: 0,
                userRating: 0,
                userFeedback: ''
            },
            issues: [],
            lastSaved: null
        };

        let currentRating = 0;
        let autoSaveTimer = null;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeEditor();
            setupAutoSave();
            loadDraftData();
        });

        function initializeEditor() {
            console.log('å¤ç›˜ç¼–è¾‘å™¨åˆå§‹åŒ–å®Œæˆ');
            
            // åˆå§‹åŒ–è¯„åˆ†æ˜¾ç¤º
            updateRatingDisplay(0);
            
            // ç»‘å®šè¾“å…¥äº‹ä»¶
            setupInputListeners();
        }

        function setupInputListeners() {
            // ç›‘å¬æ‰€æœ‰è¾“å…¥æ¡†çš„å˜åŒ–
            const inputs = document.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    scheduleAutoSave();
                });
            });
        }

        // è‡ªåŠ¨ä¿å­˜è®¾ç½®
        function setupAutoSave() {
            setInterval(() => {
                saveDraftData();
            }, 30000); // æ¯30ç§’è‡ªåŠ¨ä¿å­˜
        }

        function scheduleAutoSave() {
            clearTimeout(autoSaveTimer);
            autoSaveTimer = setTimeout(() => {
                saveDraftData();
            }, 2000); // åœæ­¢è¾“å…¥2ç§’åä¿å­˜
        }

        // å­—æ•°ç»Ÿè®¡
        function updateWordCount(section) {
            let wordCount = 0;
            let maxWords = 2000;
            
            switch(section) {
                case 'highlights':
                    const highlightsEditor = document.getElementById('highlightsEditor');
                    wordCount = highlightsEditor.value.length;
                    document.getElementById('highlightsWordCount').textContent = `${wordCount}/${maxWords}`;
                    break;
                    
                case 'marketData':
                    const userFeedback = document.getElementById('userFeedback');
                    wordCount = userFeedback.value.length;
                    maxWords = 1000;
                    document.getElementById('marketDataWordCount').textContent = `${wordCount}/${maxWords}`;
                    break;
                    
                case 'issues':
                    const issueTextareas = document.querySelectorAll('.issue-textarea');
                    wordCount = Array.from(issueTextareas).reduce((total, textarea) => {
                        return total + textarea.value.length;
                    }, 0);
                    document.getElementById('issuesWordCount').textContent = `${wordCount}/${maxWords}`;
                    break;
            }
        }

        // å¯Œæ–‡æœ¬ç¼–è¾‘åŠŸèƒ½
        function formatText(command) {
            document.execCommand(command, false, null);
        }

        function insertList() {
            document.execCommand('insertUnorderedList');
        }

        function insertImage(section) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = `<img src="${e.target.result}" style="max-width: 100%; height: auto; margin: 8px 0;">`;
                        document.execCommand('insertHTML', false, img);
                    };
                    reader.readAsDataURL(file);
                }
            };
            
            input.click();
        }

        // æ¨¡æ¿æ’å…¥
        function insertTemplate(section, template) {
            const editor = document.getElementById(section === 'highlights' ? 'highlightsEditor' : 'userFeedback');
            const currentValue = editor.value;
            const newValue = currentValue ? currentValue + '\n\n' + template : template;
            editor.value = newValue;
            editor.focus();
            updateWordCount(section);
        }

        // è¯„åˆ†ç³»ç»Ÿ
        function setRating(rating) {
            currentRating = rating;
            updateRatingDisplay(rating);
            updateChart();
        }

        function updateRatingDisplay(rating) {
            const stars = document.querySelectorAll('.star');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
            
            document.getElementById('ratingValue').textContent = `${rating}åˆ†`;
        }

        // å›¾è¡¨æ›´æ–°
        function updateChart() {
            const salesVolume = parseInt(document.getElementById('salesVolume').value) || 0;
            const conversionRate = parseFloat(document.getElementById('conversionRate').value) || 0;
            
            // æ›´æ–°é”€é‡æ¡
            const salesPercentage = Math.min((salesVolume / 1000) * 100, 100); // å‡è®¾1000ä¸ºæ»¡å€¼
            document.getElementById('salesBar').style.width = `${salesPercentage}%`;
            document.getElementById('salesValue').textContent = salesVolume;
            
            // æ›´æ–°è½¬åŒ–ç‡æ¡
            document.getElementById('conversionBar').style.width = `${conversionRate}%`;
            document.getElementById('conversionValue').textContent = `${conversionRate}%`;
            
            // æ›´æ–°è¯„åˆ†æ¡
            const ratingPercentage = (currentRating / 5) * 100;
            document.getElementById('ratingBar').style.width = `${ratingPercentage}%`;
            document.getElementById('ratingBarValue').textContent = `${currentRating}åˆ†`;
        }

        // é—®é¢˜åˆ—è¡¨ç®¡ç†
        function addIssue() {
            const issuesList = document.getElementById('issuesList');
            
            const issueItem = document.createElement('div');
            issueItem.className = 'issue-item';
            issueItem.innerHTML = `
                <div class="issue-header">
                    <select class="priority-select">
                        <option value="high">é«˜ä¼˜å…ˆçº§</option>
                        <option value="medium" selected>ä¸­ä¼˜å…ˆçº§</option>
                        <option value="low">ä½ä¼˜å…ˆçº§</option>
                    </select>
                    <button class="remove-issue" onclick="removeIssue(this)">Ã—</button>
                </div>
                <div class="issue-content">
                    <textarea 
                        class="issue-textarea" 
                        placeholder="é—®é¢˜æè¿°..."
                        oninput="updateWordCount('issues')"
                    ></textarea>
                    <textarea 
                        class="issue-textarea" 
                        placeholder="æ”¹è¿›å»ºè®®..."
                        oninput="updateWordCount('issues')"
                    ></textarea>
                </div>
            `;
            
            issuesList.appendChild(issueItem);
            
            // æ»šåŠ¨åˆ°æ–°æ·»åŠ çš„é—®é¢˜
            issueItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function removeIssue(button) {
            const issueItem = button.closest('.issue-item');
            issueItem.remove();
            updateWordCount('issues');
        }

        // æ•°æ®ä¿å­˜å’ŒåŠ è½½
        function collectReviewData() {
            const issues = [];
            const issueItems = document.querySelectorAll('.issue-item');
            
            issueItems.forEach(item => {
                const priority = item.querySelector('.priority-select').value;
                const textareas = item.querySelectorAll('.issue-textarea');
                const description = textareas[0].value.trim();
                const improvement = textareas[1].value.trim();
                
                if (description || improvement) {
                    issues.push({
                        priority,
                        description,
                        improvement
                    });
                }
            });
            
            return {
                projectId: reviewData.projectId,
                highlights: document.getElementById('highlightsEditor').value,
                marketData: {
                    salesVolume: parseInt(document.getElementById('salesVolume').value) || 0,
                    conversionRate: parseFloat(document.getElementById('conversionRate').value) || 0,
                    userRating: currentRating,
                    userFeedback: document.getElementById('userFeedback').value
                },
                issues: issues,
                lastSaved: new Date().toISOString()
            };
        }

        function saveDraftData() {
            const data = collectReviewData();
            localStorage.setItem('reviewDraft_' + data.projectId, JSON.stringify(data));
            
            // æ˜¾ç¤ºä¿å­˜æç¤º
            showAutoSaveIndicator();
        }

        function loadDraftData() {
            const savedData = localStorage.getItem('reviewDraft_' + reviewData.projectId);
            if (savedData) {
                const data = JSON.parse(savedData);
                
                // æ¢å¤æ•°æ®
                document.getElementById('highlightsEditor').value = data.highlights || '';
                document.getElementById('salesVolume').value = data.marketData.salesVolume || '';
                document.getElementById('conversionRate').value = data.marketData.conversionRate || '';
                document.getElementById('userFeedback').value = data.marketData.userFeedback || '';
                
                setRating(data.marketData.userRating || 0);
                
                // æ¢å¤é—®é¢˜åˆ—è¡¨
                if (data.issues && data.issues.length > 0) {
                    const issuesList = document.getElementById('issuesList');
                    issuesList.innerHTML = ''; // æ¸…ç©ºé»˜è®¤é¡¹
                    
                    data.issues.forEach(issue => {
                        addIssueWithData(issue);
                    });
                }
                
                updateChart();
                updateWordCount('highlights');
                updateWordCount('marketData');
                updateWordCount('issues');
                
                showNotification('å·²æ¢å¤è‰ç¨¿æ•°æ®', 'info');
            }
        }

        function addIssueWithData(issueData) {
            const issuesList = document.getElementById('issuesList');
            
            const issueItem = document.createElement('div');
            issueItem.className = 'issue-item';
            issueItem.innerHTML = `
                <div class="issue-header">
                    <select class="priority-select">
                        <option value="high" ${issueData.priority === 'high' ? 'selected' : ''}>é«˜ä¼˜å…ˆçº§</option>
                        <option value="medium" ${issueData.priority === 'medium' ? 'selected' : ''}>ä¸­ä¼˜å…ˆçº§</option>
                        <option value="low" ${issueData.priority === 'low' ? 'selected' : ''}>ä½ä¼˜å…ˆçº§</option>
                    </select>
                    <button class="remove-issue" onclick="removeIssue(this)">Ã—</button>
                </div>
                <div class="issue-content">
                    <textarea 
                        class="issue-textarea" 
                        placeholder="é—®é¢˜æè¿°..."
                        oninput="updateWordCount('issues')"
                    >${issueData.description}</textarea>
                    <textarea 
                        class="issue-textarea" 
                        placeholder="æ”¹è¿›å»ºè®®..."
                        oninput="updateWordCount('issues')"
                    >${issueData.improvement}</textarea>
                </div>
            `;
            
            issuesList.appendChild(issueItem);
        }

        // ä¿å­˜è‰ç¨¿
        function saveDraft() {
            saveDraftData();
            showNotification('è‰ç¨¿å·²ä¿å­˜', 'success');
        }

        // æäº¤å¤ç›˜
        function submitReview() {
            const data = collectReviewData();
            
            // éªŒè¯å¿…å¡«é¡¹
            if (!data.highlights.trim()) {
                showNotification('è¯·å¡«å†™è®¾è®¡äº®ç‚¹å†…å®¹', 'error');
                return;
            }
            
            if (data.issues.length === 0) {
                showNotification('è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªé—®é¢˜å’Œæ”¹è¿›å»ºè®®', 'error');
                return;
            }
            
            // æ¨¡æ‹Ÿæäº¤
            console.log('æäº¤å¤ç›˜æ•°æ®:', data);
            
            showNotification('å¤ç›˜æäº¤æˆåŠŸï¼', 'success');
            
            // æ¸…é™¤è‰ç¨¿
            localStorage.removeItem('reviewDraft_' + data.projectId);
            
            // 2ç§’åè·³è½¬
            setTimeout(() => {
                goBack();
            }, 2000);
        }

        // è¿”å›ä¸Šä¸€é¡µ
        function goBack() {
            if (window.history.length > 1) {
                window.history.back();
            } else {
                window.location.href = 'project-detail.html';
            }
        }

        // æ˜¾ç¤ºè‡ªåŠ¨ä¿å­˜æŒ‡ç¤ºå™¨
        function showAutoSaveIndicator() {
            const indicator = document.getElementById('autoSaveIndicator');
            indicator.classList.add('show');
            
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }

        // é€šçŸ¥ç³»ç»Ÿ
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                padding: 12px 20px;
                border-radius: 6px;
                color: white;
                font-size: 14px;
                z-index: 3000;
                transition: all 0.3s ease;
                box-shadow: 0 4px 16px rgba(0,0,0,0.15);
            `;
            
            const colors = {
                'success': '#10b981',
                'error': '#ef4444',
                'warning': '#f59e0b',
                'info': '#3b82f6'
            };
            
            notification.style.backgroundColor = colors[type] || colors.info;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + S ä¿å­˜è‰ç¨¿
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                saveDraft();
            }
            
            // Ctrl/Cmd + Enter æäº¤
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                submitReview();
            }
            
            // ESC è¿”å›
            if (e.key === 'Escape') {
                goBack();
            }
        });

        // é¡µé¢ç¦»å¼€å‰ç¡®è®¤
        window.addEventListener('beforeunload', function(e) {
            const data = collectReviewData();
            const hasContent = data.highlights.trim() || 
                             data.marketData.userFeedback.trim() || 
                             data.issues.length > 0;
            
            if (hasContent) {
                const message = 'æ‚¨æœ‰æœªä¿å­˜çš„å¤ç›˜å†…å®¹ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ';
                e.returnValue = message;
                return message;
            }
        });
    </script>
</body>
</html>