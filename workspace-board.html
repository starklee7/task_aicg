<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>需求⇄复盘协同板 - AIGC服装设计</title>
    <style>
        /* 全局样式重置与基础设置 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background-color: #fafbfc;
            color: #4b5563;
            line-height: 1.6;
        }

        /* 配色方案变量 */
        :root {
            --primary-blue: #3b82f6;
            --success-green: #10b981;
            --warning-orange: #f59e0b;
            --error-red: #ef4444;
            --neutral-gray: #6b7280;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --text-primary: #111827;
            --text-secondary: #374151;
            --text-body: #4b5563;
            --text-muted: #9ca3af;
            --border-color: #e5e7eb;
        }

        /* 顶部导航栏 */
        .header {
            height: 80px;
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-blue), #60a5fa);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 16px;
        }

        .page-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .header-center {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .role-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            color: white;
        }

        .role-badge.client { background: var(--primary-blue); }
        .role-badge.designer { background: var(--success-green); }
        .role-badge.operator { background: var(--warning-orange); }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s;
        }

        .notification-icon:hover {
            background: var(--bg-tertiary);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ec4899, #f97316);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            cursor: pointer;
        }

        /* 主内容区域 */
        .main-content {
            margin-top: 80px;
            padding: 24px;
            min-height: calc(100vh - 80px);
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        /* 复盘要点展示区 */
        .review-section {
            height: 40vh;
            min-height: 300px;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .refresh-btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-body);
            transition: all 0.2s;
        }

        .refresh-btn:hover {
            border-color: var(--primary-blue);
            color: var(--primary-blue);
        }

        .review-cards {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            height: calc(100% - 60px);
        }

        .review-card {
            background: var(--bg-primary);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            padding: 20px;
            position: relative;
            border-top: 4px solid;
            transition: all 0.3s ease;
        }

        .review-card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
            transform: translateY(-2px);
        }

        .review-card.highlights { border-color: var(--success-green); }
        .review-card.market-data { border-color: var(--primary-blue); }
        .review-card.issues { border-color: var(--warning-orange); }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .card-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-icon {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
        }

        .highlights .card-icon { background: var(--success-green); }
        .market-data .card-icon { background: var(--primary-blue); }
        .issues .card-icon { background: var(--warning-orange); }

        .apply-btn {
            padding: 4px 8px;
            background: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .apply-btn:hover {
            background: #2563eb;
        }

        .card-content {
            font-size: 13px;
            color: var(--text-body);
            line-height: 1.5;
            max-height: 200px;
            overflow: hidden;
        }

        .card-content.collapsed {
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
        }

        .expand-btn {
            color: var(--primary-blue);
            cursor: pointer;
            font-size: 12px;
            margin-top: 8px;
        }

        .expand-btn:hover {
            text-decoration: underline;
        }

        /* 看板视图区 */
        .kanban-section {
            flex: 1;
            min-height: 60vh;
        }

        .kanban-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .add-request-btn {
            padding: 10px 20px;
            background: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
        }

        .add-request-btn:hover {
            background: #2563eb;
        }

        .kanban-board {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            height: calc(100% - 60px);
        }

        .kanban-column {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 16px;
            min-height: 400px;
        }

        .column-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border-color);
        }

        .column-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .column-count {
            background: var(--neutral-gray);
            color: white;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 12px;
            font-weight: 500;
        }

        .project-cards {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .project-card {
            width: 280px;
            height: 160px;
            background: var(--bg-primary);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .project-card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
            transform: translateY(-2px);
            border-color: var(--primary-blue);
        }

        .project-card.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        .card-thumbnail {
            width: 100%;
            height: 60px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            font-size: 12px;
            border: 2px dashed var(--border-color);
        }

        .card-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 4px;
        }

        .card-info {
            flex: 1;
        }

        .card-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .card-meta {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .card-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .status-tag {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            color: white;
        }

        .status-tag.pending { background: var(--neutral-gray); }
        .status-tag.designing { background: var(--warning-orange); }
        .status-tag.ready { background: var(--primary-blue); }
        .status-tag.testing { background: #8b5cf6; }
        .status-tag.completed { background: var(--success-green); }

        .card-time {
            font-size: 11px;
            color: var(--text-muted);
        }

        /* 响应式设计 */
        @media (max-width: 1439px) {
            .review-cards {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            .kanban-board {
                grid-template-columns: repeat(3, 1fr);
                gap: 16px;
            }
        }

        @media (max-width: 767px) {
            .header {
                padding: 0 16px;
            }
            .header-center {
                display: none;
            }
            .main-content {
                padding: 16px;
            }
            .kanban-board {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            .project-card {
                width: 100%;
            }
        }

        /* 弹框遮罩 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-overlay.show {
            display: flex;
        }
    </style>
</head>
<body>
    <!-- 顶部导航栏 -->
    <header class="header">
        <div class="header-left">
            <div class="logo">AI</div>
            <h1 class="page-title">需求⇄复盘协同板</h1>
        </div>
        <div class="header-center">
            <div class="role-badge client" id="roleBadge">客户</div>
        </div>
        <div class="header-right">
            <div class="notification-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                    <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                </svg>
            </div>
            <div class="user-avatar">张</div>
        </div>
    </header>

    <!-- 主内容区域 -->
    <main class="main-content">
        <!-- 复盘要点展示区 -->
        <section class="review-section">
            <div class="section-header">
                <h2 class="section-title">上轮复盘要点</h2>
                <button class="refresh-btn">🔄 刷新</button>
            </div>
            <div class="review-cards">
                <!-- 设计亮点卡片 -->
                <div class="review-card highlights">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon">✨</div>
                            设计亮点
                        </div>
                        <button class="apply-btn" onclick="applyReviewData('highlights')">一键应用</button>
                    </div>
                    <div class="card-content collapsed" id="highlightsContent">
                        本次设计在色彩搭配上采用了渐变蓝色系，很好地体现了科技感和现代感。设计师巧妙运用了几何线条和流畅曲线的结合，创造出既有结构美又不失柔和的视觉效果。面料选择上采用了新型的透气面料，既保证了舒适度又增加了功能性。整体设计风格简约而不简单，符合目标用户群体的审美偏好。细节处理上，袖口和领口的特殊工艺处理增加了产品的精致感和品质感。
                    </div>
                    <div class="expand-btn" onclick="toggleExpand('highlightsContent', this)">展开</div>
                </div>

                <!-- 市场数据表现卡片 -->
                <div class="review-card market-data">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon">📊</div>
                            市场数据表现
                        </div>
                        <button class="apply-btn" onclick="applyReviewData('market-data')">一键应用</button>
                    </div>
                    <div class="card-content collapsed" id="marketDataContent">
                        预售阶段数据表现优异，7天预售期内收获订单285单，转化率达到12.3%，远超行业平均水平8.5%。用户反馈评分平均4.7分（满分5分），其中设计美观度获得4.8分高分。社交媒体传播效果良好，相关话题讨论量达到15.6万次，正面评价占比87%。价格接受度调研显示，68%的用户认为价格合理，符合产品价值定位。地域分布数据显示一线城市占比45%，二线城市占比38%，下沉市场潜力巨大。
                    </div>
                    <div class="expand-btn" onclick="toggleExpand('marketDataContent', this)">展开</div>
                </div>

                <!-- 问题与改进卡片 -->
                <div class="review-card issues">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon">⚠️</div>
                            问题 & 改进
                        </div>
                        <button class="apply-btn" onclick="applyReviewData('issues')">一键应用</button>
                    </div>
                    <div class="card-content collapsed" id="issuesContent">
                        生产周期较预期延长了3天，主要因为新工艺的学习曲线影响。建议下次在设计阶段就与生产团队深度沟通，确保工艺可行性。颜色还原度与设计稿存在5%左右的偏差，需要优化供应链的颜色管理流程。部分用户反馈尺码偏小，建议在下一版本中调整尺码标准。包装设计虽然精美但成本偏高，可以考虑在保持美观度的前提下优化包装方案。物流配送在偏远地区存在延迟，需要扩展配送网络覆盖。
                    </div>
                    <div class="expand-btn" onclick="toggleExpand('issuesContent', this)">展开</div>
                </div>
            </div>
        </section>

        <!-- 看板视图区 -->
        <section class="kanban-section">
            <div class="kanban-header">
                <h2 class="section-title">项目看板</h2>
                <button class="add-request-btn" onclick="openNewRequestModal()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    新增需求
                </button>
            </div>
            <div class="kanban-board">
                <!-- 需求待确认 -->
                <div class="kanban-column" data-status="pending">
                    <div class="column-header">
                        <div class="column-title">需求待确认</div>
                        <div class="column-count">2</div>
                    </div>
                    <div class="project-cards">
                        <div class="project-card" draggable="true" onclick="openProjectDetail('proj-001')">
                            <div class="card-thumbnail">
                                <span>暂无设计稿</span>
                            </div>
                            <div class="card-info">
                                <div class="card-name">春季休闲T恤设计</div>
                                <div class="card-meta">客户：潮流品牌 | 青年女性</div>
                            </div>
                            <div class="card-footer">
                                <div class="status-tag pending">待确认</div>
                                <div class="card-time">2小时前</div>
                            </div>
                        </div>

                        <div class="project-card" draggable="true" onclick="openProjectDetail('proj-002')">
                            <div class="card-thumbnail">
                                <span>暂无设计稿</span>
                            </div>
                            <div class="card-info">
                                <div class="card-name">商务衬衫系列</div>
                                <div class="card-meta">客户：职场品牌 | 商务男性</div>
                            </div>
                            <div class="card-footer">
                                <div class="status-tag pending">待确认</div>
                                <div class="card-time">1天前</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 设计中 -->
                <div class="kanban-column" data-status="designing">
                    <div class="column-header">
                        <div class="column-title">设计中</div>
                        <div class="column-count">1</div>
                    </div>
                    <div class="project-cards">
                        <div class="project-card" draggable="true" onclick="openProjectDetail('proj-003')">
                            <div class="card-thumbnail">
                                <span>设计进行中...</span>
                            </div>
                            <div class="card-info">
                                <div class="card-name">夏季连衣裙</div>
                                <div class="card-meta">客户：时尚品牌 | 青年女性</div>
                            </div>
                            <div class="card-footer">
                                <div class="status-tag designing">设计中</div>
                                <div class="card-time">3天前</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 待交付 -->
                <div class="kanban-column" data-status="ready">
                    <div class="column-header">
                        <div class="column-title">待交付</div>
                        <div class="column-count">1</div>
                    </div>
                    <div class="project-cards">
                        <div class="project-card" draggable="true" onclick="openProjectDetail('proj-004')">
                            <div class="card-thumbnail">
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='60' viewBox='0 0 100 60'%3E%3Crect width='100' height='60' fill='%23e5e7eb'/%3E%3Ctext x='50' y='35' text-anchor='middle' fill='%236b7280' font-size='12'%3E设计稿预览%3C/text%3E%3C/svg%3E" alt="设计稿">
                            </div>
                            <div class="card-info">
                                <div class="card-name">秋季外套系列</div>
                                <div class="card-meta">客户：户外品牌 | 青年男性</div>
                            </div>
                            <div class="card-footer">
                                <div class="status-tag ready">待交付</div>
                                <div class="card-time">5天前</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 预售测试 -->
                <div class="kanban-column" data-status="testing">
                    <div class="column-header">
                        <div class="column-title">预售测试</div>
                        <div class="column-count">1</div>
                    </div>
                    <div class="project-cards">
                        <div class="project-card" draggable="true" onclick="openProjectDetail('proj-005')">
                            <div class="card-thumbnail">
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='60' viewBox='0 0 100 60'%3E%3Crect width='100' height='60' fill='%23ddd6fe'/%3E%3Ctext x='50' y='35' text-anchor='middle' fill='%238b5cf6' font-size='12'%3E测试中%3C/text%3E%3C/svg%3E" alt="设计稿">
                            </div>
                            <div class="card-info">
                                <div class="card-name">冬季针织衫</div>
                                <div class="card-meta">客户：舒适品牌 | 中年女性</div>
                            </div>
                            <div class="card-footer">
                                <div class="status-tag testing">预售测试</div>
                                <div class="card-time">1周前</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 已复盘 -->
                <div class="kanban-column" data-status="completed">
                    <div class="column-header">
                        <div class="column-title">已复盘</div>
                        <div class="column-count">2</div>
                    </div>
                    <div class="project-cards">
                        <div class="project-card" draggable="true" onclick="openProjectDetail('proj-006')">
                            <div class="card-thumbnail">
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='60' viewBox='0 0 100 60'%3E%3Crect width='100' height='60' fill='%23dcfce7'/%3E%3Ctext x='50' y='35' text-anchor='middle' fill='%2310b981' font-size='12'%3E已完成%3C/text%3E%3C/svg%3E" alt="设计稿">
                            </div>
                            <div class="card-info">
                                <div class="card-name">运动休闲套装</div>
                                <div class="card-meta">客户：运动品牌 | 青年男性</div>
                            </div>
                            <div class="card-footer">
                                <div class="status-tag completed">已复盘</div>
                                <div class="card-time">2周前</div>
                            </div>
                        </div>

                        <div class="project-card" draggable="true" onclick="openProjectDetail('proj-007')">
                            <div class="card-thumbnail">
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='60' viewBox='0 0 100 60'%3E%3Crect width='100' height='60' fill='%23dcfce7'/%3E%3Ctext x='50' y='35' text-anchor='middle' fill='%2310b981' font-size='12'%3E已完成%3C/text%3E%3C/svg%3E" alt="设计稿">
                            </div>
                            <div class="card-info">
                                <div class="card-name">职场女装系列</div>
                                <div class="card-meta">客户：职场品牌 | 职业女性</div>
                            </div>
                            <div class="card-footer">
                                <div class="status-tag completed">已复盘</div>
                                <div class="card-time">3周前</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- 弹框遮罩 -->
    <div class="modal-overlay" id="modalOverlay">
        <!-- 弹框内容将通过JavaScript动态加载 -->
    </div>

    <script>
        // 全局状态管理
        let currentUser = {
            role: 'client', // client, designer, operator
            name: '张三',
            avatar: '张'
        };

        let appliedReviewTags = [];

        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupDragAndDrop();
            setupRoleBasedUI();
        });

        function initializeApp() {
            console.log('AIGC协同板系统初始化完成');
        }

        // 角色权限控制
        function setupRoleBasedUI() {
            const roleBadge = document.getElementById('roleBadge');
            const addRequestBtn = document.querySelector('.add-request-btn');
            
            switch(currentUser.role) {
                case 'client':
                    roleBadge.textContent = '客户';
                    roleBadge.className = 'role-badge client';
                    break;
                case 'designer':
                    roleBadge.textContent = '设计师';
                    roleBadge.className = 'role-badge designer';
                    break;
                case 'operator':
                    roleBadge.textContent = '运营';
                    roleBadge.className = 'role-badge operator';
                    break;
            }
        }

        // 复盘内容展开/折叠
        function toggleExpand(contentId, button) {
            const content = document.getElementById(contentId);
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                button.textContent = '收起';
            } else {
                content.classList.add('collapsed');
                button.textContent = '展开';
            }
        }

        // 应用复盘数据
        function applyReviewData(type) {
            const typeMap = {
                'highlights': '设计亮点',
                'market-data': '市场数据',
                'issues': '问题改进'
            };
            
            const tag = {
                id: Date.now(),
                type: type,
                label: typeMap[type],
                content: document.getElementById(type === 'highlights' ? 'highlightsContent' : 
                                               type === 'market-data' ? 'marketDataContent' : 'issuesContent').textContent
            };
            
            appliedReviewTags.push(tag);
            
            // 显示提示信息
            showNotification(`已应用"${tag.label}"到新需求表单`, 'success');
        }

        // 拖拽功能设置
        function setupDragAndDrop() {
            const cards = document.querySelectorAll('.project-card');
            const columns = document.querySelectorAll('.kanban-column');

            cards.forEach(card => {
                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragend', handleDragEnd);
            });

            columns.forEach(column => {
                column.addEventListener('dragover', handleDragOver);
                column.addEventListener('drop', handleDrop);
            });
        }

        function handleDragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.outerHTML);
            e.target.classList.add('dragging');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDrop(e) {
            e.preventDefault();
            const draggedCard = document.querySelector('.dragging');
            const targetColumn = e.currentTarget;
            const targetCards = targetColumn.querySelector('.project-cards');
            
            if (draggedCard && targetCards) {
                // 检查权限
                if (!checkMovePermission(targetColumn.dataset.status)) {
                    showNotification('您没有权限移动到此状态', 'error');
                    return;
                }
                
                targetCards.appendChild(draggedCard);
                updateCardStatus(draggedCard, targetColumn.dataset.status);
                updateColumnCounts();
                
                // 模拟WebSocket实时更新
                showNotification('项目状态已更新', 'success');
            }
        }

        function checkMovePermission(targetStatus) {
            // 权限检查逻辑
            if (currentUser.role === 'operator') return true;
            if (currentUser.role === 'designer' && 
                (targetStatus === 'designing' || targetStatus === 'ready')) return true;
            if (currentUser.role === 'client') return false;
            
            return false;
        }

        function updateCardStatus(card, newStatus) {
            const statusTag = card.querySelector('.status-tag');
            const statusMap = {
                'pending': { text: '待确认', class: 'pending' },
                'designing': { text: '设计中', class: 'designing' },
                'ready': { text: '待交付', class: 'ready' },
                'testing': { text: '预售测试', class: 'testing' },
                'completed': { text: '已复盘', class: 'completed' }
            };
            
            const statusInfo = statusMap[newStatus];
            statusTag.textContent = statusInfo.text;
            statusTag.className = `status-tag ${statusInfo.class}`;
            
            // 更新时间
            const timeElement = card.querySelector('.card-time');
            timeElement.textContent = '刚刚';
        }

        function updateColumnCounts() {
            const columns = document.querySelectorAll('.kanban-column');
            columns.forEach(column => {
                const count = column.querySelectorAll('.project-card').length;
                const countElement = column.querySelector('.column-count');
                countElement.textContent = count;
            });
        }

        // 打开新需求表单弹框
        function openNewRequestModal() {
            // 这里将调用新需求表单弹框
            showNotification('正在打开新需求表单...', 'info');
        }

        // 打开项目详情页
        function openProjectDetail(projectId) {
            showNotification(`正在打开项目 ${projectId} 详情...`, 'info');
        }

        // 通知系统
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                padding: 12px 20px;
                border-radius: 6px;
                color: white;
                font-size: 14px;
                z-index: 3000;
                transition: all 0.3s ease;
                box-shadow: 0 4px 16px rgba(0,0,0,0.15);
            `;
            
            const colors = {
                'success': '#10b981',
                'error': '#ef4444',
                'warning': '#f59e0b',
                'info': '#3b82f6'
            };
            
            notification.style.backgroundColor = colors[type] || colors.info;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // 切换用户角色（调试用）
        function switchRole(role) {
            currentUser.role = role;
            setupRoleBasedUI();
            showNotification(`已切换到${role === 'client' ? '客户' : role === 'designer' ? '设计师' : '运营'}角色`, 'info');
        }

        // 键盘快捷键
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + N 新增需求
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                openNewRequestModal();
            }
            
            // 角色切换快捷键 (调试用)
            if (e.altKey) {
                switch(e.key) {
                    case '1': switchRole('client'); break;
                    case '2': switchRole('designer'); break;
                    case '3': switchRole('operator'); break;
                }
            }
        });
    </script>
</body>
</html>